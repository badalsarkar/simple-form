<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data Table</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- DataTables CSS -->
    <link
      href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container mt-5">
      <h1 class="mb-4 text-center">Data Table</h1>
      <div class="d-flex justify-content-between mb-3">
        <a href="{{ url_for('create_item') }}" class="btn btn-success"
          >Create New Record</a
        >
      </div>
      <table id="dataTable" class="table table-striped table-bordered">
        <thead class="thead-dark">
          <tr>
            <th>ID</th>
            <th>
              <div class="d-flex justify-content-between align-items-center">
                Name
                <div class="dropdown ms-auto">
                  <button
                    class="btn btn-secondary btn-sm dropdown-toggle"
                    type="button"
                    id="nameDropdown"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                  >
                    <i class="fas fa-filter"></i>
                  </button>
                  <ul
                    class="dropdown-menu"
                    aria-labelledby="nameDropdown"
                    id="nameFilterMenu"
                  >
                    <li>
                      <a class="dropdown-item" href="#" data-value="">All</a>
                    </li>
                    <!-- Unique names will be populated here -->
                  </ul>
                </div>
              </div>
            </th>
            <th>Description</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for item in items %}
          <tr>
            <td>{{ item.id }}</td>
            <td>{{ item.name }}</td>
            <td>{{ item.description }}</td>
            <td>
              <a
                href="{{ url_for('edit_item', item_id=item.id) }}"
                class="btn btn-primary btn-sm"
              >
                <i class="fas fa-edit"></i>
              </a>
              <form
                action="{{ url_for('delete_item', item_id=item.id) }}"
                method="POST"
                style="display: inline"
              >
                <button type="submit" class="btn btn-danger btn-sm">
                  <i class="fas fa-trash-alt"></i>
                </button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
    <!-- Initialize DataTables with Column Search -->
    <script>
      $(document).ready(function () {
        var table = $("#dataTable").DataTable({
          paging: true,
          searching: true,
          ordering: true,
        });

        // Get unique names and populate the dropdown
        var uniqueNames = [];
        table
          .column(1)
          .data()
          .unique()
          .each(function (d, j) {
            if (d && uniqueNames.indexOf(d) === -1) {
              uniqueNames.push(d);
              $("#nameFilterMenu").append(
                '<li><a class="dropdown-item" href="#" data-value="' +
                  d +
                  '">' +
                  d +
                  "</a></li>",
              );
            }
          });

        // Filter the table when a dropdown item is clicked
        $("#nameFilterMenu").on("click", "a", function () {
          var filterValue = $(this).data("value");
          table.column(1).search(filterValue).draw();
        });
      });
    </script>
  </body>
</html>
